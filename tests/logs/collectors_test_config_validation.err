+ set -euo pipefail
++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/test_config_validation.sh
+ source /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
++ set -euo pipefail
++++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
+++ cd /data/projects/vibe_cockpit/tests/e2e/collectors/../lib
+++ pwd
++ TEST_LIB_DIR=/data/projects/vibe_cockpit/tests/e2e/lib
+++ dirname /data/projects/vibe_cockpit/tests/e2e/lib
++ E2E_DIR=/data/projects/vibe_cockpit/tests/e2e
+++ cd /data/projects/vibe_cockpit/tests/e2e/../..
+++ pwd
++ PROJECT_ROOT=/data/projects/vibe_cockpit
+++ find_vc_binary
+++ [[ -n /data/tmp/cargo-target ]]
+++ [[ -x /data/tmp/cargo-target/debug/vc ]]
+++ echo /data/tmp/cargo-target/debug/vc
+++ return
++ VC_BIN=/data/tmp/cargo-target/debug/vc
+++ basename /data/projects/vibe_cockpit/tests/e2e/collectors/test_config_validation.sh .sh
++ TEST_NAME=test_config_validation
++ TEST_ASSERTIONS=0
++ TEST_FAILURES=0
+++ date +%s%N
++ TEST_START_TIME=1769621027001540934
++ RED='\033[0;31m'
++ GREEN='\033[0;32m'
++ YELLOW='\033[1;33m'
++ NC='\033[0m'
++ trap cleanup_test_env EXIT
+ test_info 'Starting configuration validation E2E test'
+ test_log INFO 'Starting configuration validation E2E test'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Starting configuration validation E2E test'
[2026-01-28T12:23:47-05:00] [INFO] Starting configuration validation E2E test
+ setup_test_env
+ test_info 'Setting up test environment'
+ test_log INFO 'Setting up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Setting up test environment'
[2026-01-28T12:23:47-05:00] [INFO] Setting up test environment
++ mktemp -d -t vc_e2e_test_config_validation_XXXXXX
+ TEST_TEMP_DIR=/data/tmp/vc_e2e_test_config_validation_3zQypb
+ export TEST_TEMP_DIR
+ TEST_DB_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/test.duckdb
+ export TEST_DB_PATH
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml
+ cat
+ export TEST_CONFIG_PATH
+ test_info 'Test temp dir: /data/tmp/vc_e2e_test_config_validation_3zQypb'
+ test_log INFO 'Test temp dir: /data/tmp/vc_e2e_test_config_validation_3zQypb'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_config_validation_3zQypb'
[2026-01-28T12:23:47-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_config_validation_3zQypb
+ test_info 'Test 1: Valid config parsing'
+ test_log INFO 'Test 1: Valid config parsing'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Test 1: Valid config parsing'
[2026-01-28T12:23:47-05:00] [INFO] Test 1: Valid config parsing
++ run_vc --version
+ version_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ TEST_ASSERTIONS=1
+ [[ -n ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) ]]
+ test_info 'PASS: Valid config accepted'
+ test_log INFO 'PASS: Valid config accepted'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] PASS: Valid config accepted'
[2026-01-28T12:23:47-05:00] [INFO] PASS: Valid config accepted
+ test_info 'Test 2: Config with multiple machines'
+ test_log INFO 'Test 2: Config with multiple machines'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Test 2: Config with multiple machines'
[2026-01-28T12:23:47-05:00] [INFO] Test 2: Config with multiple machines
+ cat
+ old_config=/data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/multi_machine.toml
+ export TEST_CONFIG_PATH
++ run_vc --version
+ status_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/multi_machine.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ TEST_ASSERTIONS=2
+ [[ -n ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/multi_machine.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) ]]
+ test_info 'PASS: Multi-machine config parsed'
+ test_log INFO 'PASS: Multi-machine config parsed'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] PASS: Multi-machine config parsed'
[2026-01-28T12:23:47-05:00] [INFO] PASS: Multi-machine config parsed
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml
+ export TEST_CONFIG_PATH
+ test_info 'Test 3: Config with collector settings'
+ test_log INFO 'Test 3: Config with collector settings'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:47-05:00] [INFO] Test 3: Config with collector settings'
[2026-01-28T12:23:47-05:00] [INFO] Test 3: Config with collector settings
+ cat
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/collector_config.toml
+ export TEST_CONFIG_PATH
++ run_vc --version
+ collector_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/collector_config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ TEST_ASSERTIONS=3
+ test_info 'PASS: Collector config handling completed'
+ test_log INFO 'PASS: Collector config handling completed'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] PASS: Collector config handling completed'
[2026-01-28T12:23:48-05:00] [INFO] PASS: Collector config handling completed
+ test_info 'Test 4: Invalid TOML handling'
+ test_log INFO 'Test 4: Invalid TOML handling'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] Test 4: Invalid TOML handling'
[2026-01-28T12:23:48-05:00] [INFO] Test 4: Invalid TOML handling
+ cat
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/invalid.toml
+ export TEST_CONFIG_PATH
++ run_vc --version
+ invalid_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/invalid.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ TEST_ASSERTIONS=4
+ [[ ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/invalid.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) == *\e\r\r\o\r* ]]
+ [[ ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/invalid.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) == *\E\r\r\o\r* ]]
+ [[ -z ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/invalid.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) ]]
+ test_warn 'WARN: Invalid TOML may not have been properly rejected'
+ test_log WARN 'WARN: Invalid TOML may not have been properly rejected'
+ local level=WARN
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [WARN] WARN: Invalid TOML may not have been properly rejected'
[2026-01-28T12:23:48-05:00] [WARN] WARN: Invalid TOML may not have been properly rejected
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml
+ export TEST_CONFIG_PATH
+ test_info 'Test 5: Missing config file handling'
+ test_log INFO 'Test 5: Missing config file handling'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] Test 5: Missing config file handling'
[2026-01-28T12:23:48-05:00] [INFO] Test 5: Missing config file handling
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/nonexistent.toml
+ export TEST_CONFIG_PATH
++ run_vc --version
+ missing_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_config_validation_3zQypb/nonexistent.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ TEST_ASSERTIONS=5
+ test_info 'PASS: Missing config handling completed'
+ test_log INFO 'PASS: Missing config handling completed'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] PASS: Missing config handling completed'
[2026-01-28T12:23:48-05:00] [INFO] PASS: Missing config handling completed
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_config_validation_3zQypb/config.toml
+ export TEST_CONFIG_PATH
+ finalize_test
++ date +%s%N
+ local end_time=1769621028750313524
+ local duration_ms=1748
+ local status=passed
+ local exit_code=0
+ [[ 0 -gt 0 ]]
+ cat
+ test_info 'Test complete: 5 assertions, 0 failures'
+ test_log INFO 'Test complete: 5 assertions, 0 failures'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] Test complete: 5 assertions, 0 failures'
[2026-01-28T12:23:48-05:00] [INFO] Test complete: 5 assertions, 0 failures
+ exit 0
+ cleanup_test_env
+ local exit_code=0
+ test_info 'Cleaning up test environment'
+ test_log INFO 'Cleaning up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:48-05:00] [INFO] Cleaning up test environment'
[2026-01-28T12:23:48-05:00] [INFO] Cleaning up test environment
+ [[ -n /data/tmp/vc_e2e_test_config_validation_3zQypb ]]
+ [[ -d /data/tmp/vc_e2e_test_config_validation_3zQypb ]]
+ [[ 0 -ne 0 ]]
+ rm -rf /data/tmp/vc_e2e_test_config_validation_3zQypb
