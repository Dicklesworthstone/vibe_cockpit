+ set -euo pipefail
++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/test_beads_collect.sh
+ source /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
++ set -euo pipefail
++++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
+++ cd /data/projects/vibe_cockpit/tests/e2e/collectors/../lib
+++ pwd
++ TEST_LIB_DIR=/data/projects/vibe_cockpit/tests/e2e/lib
+++ dirname /data/projects/vibe_cockpit/tests/e2e/lib
++ E2E_DIR=/data/projects/vibe_cockpit/tests/e2e
+++ cd /data/projects/vibe_cockpit/tests/e2e/../..
+++ pwd
++ PROJECT_ROOT=/data/projects/vibe_cockpit
+++ find_vc_binary
+++ [[ -n /data/tmp/cargo-target ]]
+++ [[ -x /data/tmp/cargo-target/debug/vc ]]
+++ echo /data/tmp/cargo-target/debug/vc
+++ return
++ VC_BIN=/data/tmp/cargo-target/debug/vc
+++ basename /data/projects/vibe_cockpit/tests/e2e/collectors/test_beads_collect.sh .sh
++ TEST_NAME=test_beads_collect
++ TEST_ASSERTIONS=0
++ TEST_FAILURES=0
+++ date +%s%N
++ TEST_START_TIME=1769623412507951100
++ VC_LAST_OUTPUT=
++ RED='\033[0;31m'
++ GREEN='\033[0;32m'
++ YELLOW='\033[1;33m'
++ NC='\033[0m'
++ trap cleanup_test_env EXIT
+ test_info 'Starting beads collector E2E test'
+ test_log INFO 'Starting beads collector E2E test'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:32-05:00] [INFO] Starting beads collector E2E test'
[2026-01-28T13:03:32-05:00] [INFO] Starting beads collector E2E test
+ setup_test_env
+ test_info 'Setting up test environment'
+ test_log INFO 'Setting up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:32-05:00] [INFO] Setting up test environment'
[2026-01-28T13:03:32-05:00] [INFO] Setting up test environment
++ mktemp -d -t vc_e2e_test_beads_collect_XXXXXX
+ TEST_TEMP_DIR=/data/tmp/vc_e2e_test_beads_collect_yIpF3p
+ export TEST_TEMP_DIR
+ TEST_DB_PATH=/data/tmp/vc_e2e_test_beads_collect_yIpF3p/test.duckdb
+ export TEST_DB_PATH
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_beads_collect_yIpF3p/config.toml
+ cat
+ export TEST_CONFIG_PATH
+ test_info 'Test temp dir: /data/tmp/vc_e2e_test_beads_collect_yIpF3p'
+ test_log INFO 'Test temp dir: /data/tmp/vc_e2e_test_beads_collect_yIpF3p'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:34-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_beads_collect_yIpF3p'
[2026-01-28T13:03:34-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_beads_collect_yIpF3p
+ BIN_DIR=/data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin
+ mkdir -p /data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin
+ cat
+ chmod +x /data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin/bv
+ cat
+ chmod +x /data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin/br
+ export PATH=/data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin:/home/ubuntu/.codex/tmp/path/codex-arg0eJszyB:/home/ubuntu/.bun/install/global/node_modules/@openai/codex/vendor/x86_64-unknown-linux-musl/path:/data/tmp/.tmpMpmAMF:/data/tmp/.tmpzam3q7:/data/tmp/.tmpoyAfve:/data/tmp/.tmpe6g78I:/data/tmp/.tmpPd69rK:/data/tmp/.tmpGRbjsw:/data/tmp/.tmpz2brVn:/data/tmp/.tmp0PnFJv:/data/tmp/.tmpPoRhAM:/data/tmp/.tmpFfkQ40:/data/tmp/.tmpuxSIpy:/data/tmp/.tmpXjJuNc:/data/tmp/.tmpTZnvXD:/data/tmp/.tmpuK4iIg:/data/tmp/.tmpajeyt7:/data/tmp/.tmpev6kRK:/data/tmp/.tmpiDVpJA:/data/tmp/.tmpnDRhga:/data/tmp/.tmpzxxM5v:/data/tmp/.tmpvKVXKw:/data/tmp/.tmpmNPIdP:/data/tmp/.tmpVFL4Sw:/data/tmp/.tmp7ItVFC:/data/tmp/.tmp0vGjRa:/data/tmp/.tmpBllZzw:/data/tmp/.tmpobicww:/data/tmp/.tmp8f8C2e:/data/tmp/.tmpbD8QBY:/data/tmp/.tmpjzHvSF:/data/tmp/.tmpkjqRCG:/data/tmp/.tmpVzu1zg:/data/tmp/.tmpHO13GV:/data/tmp/.tmprTmBIb:/data/tmp/.tmpRHFAS9:/data/tmp/.tmp84NBm7:/data/tmp/.tmpOXe4sc:/data/tmp/.tmpcOX7LV:/data/tmp/.tmpHmVm2g:/data/tmp/.tmp9gcOZP:/data/tmp/.tmpz4q0R1:/data/tmp/.tmpvkDZiX:/data/tmp/.tmp7Mj5dU:/data/tmp/.tmpdkiSGU:/data/tmp/.tmpDhz6SG:/data/tmp/.tmpxZwXIA:/data/tmp/.tmptoaKcg:/data/tmp/.tmp5WocB2:/data/tmp/.tmpQIUXw6:/data/tmp/.tmp3pRXXR:/data/tmp/.tmpGRxfSM:/data/tmp/.tmpLA8PkL:/data/tmp/.tmpFbmIJR:/data/tmp/.tmpWfLZ76:/data/tmp/.tmpWsTSmr:/data/tmp/.tmpxh3SQx:/data/tmp/.tmp0QcB2I:/data/tmp/.tmpxNatIO:/data/tmp/.tmpupEMqh:/data/tmp/.tmppCYdSE:/data/tmp/.tmpymdjNV:/data/tmp/.tmpCFNqVV:/data/tmp/.tmpdJ2vDZ:/data/tmp/.tmpSewNuz:/data/tmp/.tmpQlKd6y:/data/tmp/.tmprUxpI2:/run/user/1000/fnm_multishells/1141914_1769574439286/bin:/home/ubuntu/.local/share/fnm:/home/ubuntu/google-cloud-sdk/bin:/home/ubuntu/bin:/run/user/1000/fnm_multishells/1141838_1769574439149/bin:/home/ubuntu/.local/share/fnm:/home/ubuntu/google-cloud-sdk/bin:/home/ubuntu/.nvm/versions/node/v24.12.0/bin:/home/ubuntu/.local/bin:/home/ubuntu/.atuin/bin:/home/ubuntu/.bun/bin:/home/ubuntu/go/bin:/home/ubuntu/.cargo/bin:/home/ubuntu/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin:/snap/bin
+ PATH=/data/tmp/vc_e2e_test_beads_collect_yIpF3p/bin:/home/ubuntu/.codex/tmp/path/codex-arg0eJszyB:/home/ubuntu/.bun/install/global/node_modules/@openai/codex/vendor/x86_64-unknown-linux-musl/path:/data/tmp/.tmpMpmAMF:/data/tmp/.tmpzam3q7:/data/tmp/.tmpoyAfve:/data/tmp/.tmpe6g78I:/data/tmp/.tmpPd69rK:/data/tmp/.tmpGRbjsw:/data/tmp/.tmpz2brVn:/data/tmp/.tmp0PnFJv:/data/tmp/.tmpPoRhAM:/data/tmp/.tmpFfkQ40:/data/tmp/.tmpuxSIpy:/data/tmp/.tmpXjJuNc:/data/tmp/.tmpTZnvXD:/data/tmp/.tmpuK4iIg:/data/tmp/.tmpajeyt7:/data/tmp/.tmpev6kRK:/data/tmp/.tmpiDVpJA:/data/tmp/.tmpnDRhga:/data/tmp/.tmpzxxM5v:/data/tmp/.tmpvKVXKw:/data/tmp/.tmpmNPIdP:/data/tmp/.tmpVFL4Sw:/data/tmp/.tmp7ItVFC:/data/tmp/.tmp0vGjRa:/data/tmp/.tmpBllZzw:/data/tmp/.tmpobicww:/data/tmp/.tmp8f8C2e:/data/tmp/.tmpbD8QBY:/data/tmp/.tmpjzHvSF:/data/tmp/.tmpkjqRCG:/data/tmp/.tmpVzu1zg:/data/tmp/.tmpHO13GV:/data/tmp/.tmprTmBIb:/data/tmp/.tmpRHFAS9:/data/tmp/.tmp84NBm7:/data/tmp/.tmpOXe4sc:/data/tmp/.tmpcOX7LV:/data/tmp/.tmpHmVm2g:/data/tmp/.tmp9gcOZP:/data/tmp/.tmpz4q0R1:/data/tmp/.tmpvkDZiX:/data/tmp/.tmp7Mj5dU:/data/tmp/.tmpdkiSGU:/data/tmp/.tmpDhz6SG:/data/tmp/.tmpxZwXIA:/data/tmp/.tmptoaKcg:/data/tmp/.tmp5WocB2:/data/tmp/.tmpQIUXw6:/data/tmp/.tmp3pRXXR:/data/tmp/.tmpGRxfSM:/data/tmp/.tmpLA8PkL:/data/tmp/.tmpFbmIJR:/data/tmp/.tmpWfLZ76:/data/tmp/.tmpWsTSmr:/data/tmp/.tmpxh3SQx:/data/tmp/.tmp0QcB2I:/data/tmp/.tmpxNatIO:/data/tmp/.tmpupEMqh:/data/tmp/.tmppCYdSE:/data/tmp/.tmpymdjNV:/data/tmp/.tmpCFNqVV:/data/tmp/.tmpdJ2vDZ:/data/tmp/.tmpSewNuz:/data/tmp/.tmpQlKd6y:/data/tmp/.tmprUxpI2:/run/user/1000/fnm_multishells/1141914_1769574439286/bin:/home/ubuntu/.local/share/fnm:/home/ubuntu/google-cloud-sdk/bin:/home/ubuntu/bin:/run/user/1000/fnm_multishells/1141838_1769574439149/bin:/home/ubuntu/.local/share/fnm:/home/ubuntu/google-cloud-sdk/bin:/home/ubuntu/.nvm/versions/node/v24.12.0/bin:/home/ubuntu/.local/bin:/home/ubuntu/.atuin/bin:/home/ubuntu/.bun/bin:/home/ubuntu/go/bin:/home/ubuntu/.cargo/bin:/home/ubuntu/.cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin:/snap/bin
++ bv --robot-triage
+ bv_output='{
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}'
+ assert_json_valid '{
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}' 'bv triage output should be valid JSON'
+ local 'json={
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}'
+ local 'msg=bv triage output should be valid JSON'
+ TEST_ASSERTIONS=1
+ echo '{
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}'
+ jq .
+ test_info 'PASS: bv triage output should be valid JSON'
+ test_log INFO 'PASS: bv triage output should be valid JSON'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:37-05:00] [INFO] PASS: bv triage output should be valid JSON'
[2026-01-28T13:03:37-05:00] [INFO] PASS: bv triage output should be valid JSON
+ assert_json_field '{
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}' .triage.meta.version 1.0.0 'bv meta version'
+ local 'json={
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}'
+ local field=.triage.meta.version
+ local expected=1.0.0
+ local 'msg=bv meta version'
+ TEST_ASSERTIONS=2
++ echo '{
  "generated_at": "2026-01-28T00:00:00Z",
  "data_hash": "deadbeef",
  "triage": {
    "meta": {
      "version": "1.0.0",
      "generated_at": "2026-01-28T00:00:00Z",
      "phase2_ready": true,
      "issue_count": 1,
      "compute_time_ms": 5
    },
    "quick_ref": {
      "open_count": 1,
      "actionable_count": 1,
      "blocked_count": 0,
      "in_progress_count": 1,
      "top_picks": [
        {
          "id": "bd-30z",
          "title": "Create E2E test scripts with detailed logging",
          "score": 0.5,
          "reasons": ["stubbed"],
          "unblocks": 0
        }
      ]
    },
    "recommendations": [
      {
        "id": "bd-30z",
        "title": "Create E2E test scripts with detailed logging",
        "type": "task",
        "status": "in_progress",
        "priority": 1,
        "score": 0.5,
        "reasons": ["stubbed"],
        "action": "continue",
        "unblocks_ids": [],
        "blocked_by": []
      }
    ],
    "quick_wins": [],
    "blockers_to_clear": [],
    "project_health": {
      "counts": {
        "total": 1,
        "open": 1,
        "closed": 0,
        "blocked": 0,
        "actionable": 1,
        "by_status": {"open": 1},
        "by_type": {"task": 1},
        "by_priority": {"1": 1}
      },
      "graph": {
        "node_count": 1,
        "edge_count": 0,
        "density": 0.0,
        "has_cycles": false,
        "phase2_ready": true
      },
      "velocity": {
        "closed_last_7_days": 0,
        "closed_last_30_days": 0,
        "avg_days_to_close": 0.0,
        "weekly": []
      }
    }
  },
  "usage_hints": []
}'
++ jq -r .triage.meta.version
+ local actual=1.0.0
+ [[ 1.0.0 == \1\.\0\.\0 ]]
+ test_info 'PASS: bv meta version (.triage.meta.version = 1.0.0)'
+ test_log INFO 'PASS: bv meta version (.triage.meta.version = 1.0.0)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:39-05:00] [INFO] PASS: bv meta version (.triage.meta.version = 1.0.0)'
[2026-01-28T13:03:39-05:00] [INFO] PASS: bv meta version (.triage.meta.version = 1.0.0)
++ br list --format json
+ br_output='{
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}'
+ assert_json_valid '{
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}' 'br list output should be valid JSON'
+ local 'json={
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}'
+ local 'msg=br list output should be valid JSON'
+ TEST_ASSERTIONS=3
+ echo '{
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}'
+ jq .
+ test_info 'PASS: br list output should be valid JSON'
+ test_log INFO 'PASS: br list output should be valid JSON'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:42-05:00] [INFO] PASS: br list output should be valid JSON'
[2026-01-28T13:03:42-05:00] [INFO] PASS: br list output should be valid JSON
+ assert_json_field '{
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}' '.issues[0].id' bd-30z 'br issue id'
+ local 'json={
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}'
+ local 'field=.issues[0].id'
+ local expected=bd-30z
+ local 'msg=br issue id'
+ TEST_ASSERTIONS=4
++ echo '{
  "issues": [
    {
      "id": "bd-30z",
      "title": "Create E2E test scripts with detailed logging",
      "status": "in_progress",
      "priority": 1,
      "type": "task",
      "labels": ["e2e", "collectors"],
      "blocked_by": [],
      "blocks": [],
      "owner": "MaroonCove",
      "created_at": "2026-01-27T00:00:00Z",
      "updated_at": "2026-01-28T00:00:00Z"
    }
  ]
}'
++ jq -r '.issues[0].id'
+ local actual=bd-30z
+ [[ bd-30z == \b\d\-\3\0\z ]]
+ test_info 'PASS: br issue id (.issues[0].id = bd-30z)'
+ test_log INFO 'PASS: br issue id (.issues[0].id = bd-30z)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:43-05:00] [INFO] PASS: br issue id (.issues[0].id = bd-30z)'
[2026-01-28T13:03:43-05:00] [INFO] PASS: br issue id (.issues[0].id = bd-30z)
++ run_vc collect --collector beads
+ collect_output='++ local output=
++ local status=0
++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ set +e
+++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_beads_collect_yIpF3p/config.toml collect --collector beads
++ output='\''Command not yet implemented: Collect { collector: Some("beads"), machine: None }'\''
++ status=0
++ set -e
++ echo '\''Command not yet implemented: Collect { collector: Some("beads"), machine: None }'\''
Command not yet implemented: Collect { collector: Some("beads"), machine: None }
++ return 0'
+ TEST_ASSERTIONS=5
+ test_info 'PASS: vc collect --collector beads invoked'
+ test_log INFO 'PASS: vc collect --collector beads invoked'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:44-05:00] [INFO] PASS: vc collect --collector beads invoked'
[2026-01-28T13:03:44-05:00] [INFO] PASS: vc collect --collector beads invoked
+ finalize_test
++ date +%s%N
+ local end_time=1769623424970701777
+ local duration_ms=12462
+ local status=passed
+ local exit_code=0
+ [[ 0 -gt 0 ]]
+ cat
+ test_info 'Test complete: 5 assertions, 0 failures'
+ test_log INFO 'Test complete: 5 assertions, 0 failures'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:45-05:00] [INFO] Test complete: 5 assertions, 0 failures'
[2026-01-28T13:03:45-05:00] [INFO] Test complete: 5 assertions, 0 failures
+ exit 0
+ cleanup_test_env
+ local exit_code=0
+ test_info 'Cleaning up test environment'
+ test_log INFO 'Cleaning up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T13:03:45-05:00] [INFO] Cleaning up test environment'
[2026-01-28T13:03:45-05:00] [INFO] Cleaning up test environment
+ [[ -n /data/tmp/vc_e2e_test_beads_collect_yIpF3p ]]
+ [[ -d /data/tmp/vc_e2e_test_beads_collect_yIpF3p ]]
+ [[ 0 -ne 0 ]]
+ rm -rf /data/tmp/vc_e2e_test_beads_collect_yIpF3p
