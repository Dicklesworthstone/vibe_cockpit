+ set -euo pipefail
++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/test_fallback_probe.sh
+ source /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
++ set -euo pipefail
++++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
+++ cd /data/projects/vibe_cockpit/tests/e2e/collectors/../lib
+++ pwd
++ TEST_LIB_DIR=/data/projects/vibe_cockpit/tests/e2e/lib
+++ dirname /data/projects/vibe_cockpit/tests/e2e/lib
++ E2E_DIR=/data/projects/vibe_cockpit/tests/e2e
+++ cd /data/projects/vibe_cockpit/tests/e2e/../..
+++ pwd
++ PROJECT_ROOT=/data/projects/vibe_cockpit
+++ find_vc_binary
+++ [[ -n /data/tmp/cargo-target ]]
+++ [[ -x /data/tmp/cargo-target/debug/vc ]]
+++ echo /data/tmp/cargo-target/debug/vc
+++ return
++ VC_BIN=/data/tmp/cargo-target/debug/vc
+++ basename /data/projects/vibe_cockpit/tests/e2e/collectors/test_fallback_probe.sh .sh
++ TEST_NAME=test_fallback_probe
++ TEST_ASSERTIONS=0
++ TEST_FAILURES=0
+++ date +%s%N
++ TEST_START_TIME=1769621031466034511
++ RED='\033[0;31m'
++ GREEN='\033[0;32m'
++ YELLOW='\033[1;33m'
++ NC='\033[0m'
++ trap cleanup_test_env EXIT
+ test_info 'Starting fallback probe E2E test'
+ test_log INFO 'Starting fallback probe E2E test'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] Starting fallback probe E2E test'
[2026-01-28T12:23:51-05:00] [INFO] Starting fallback probe E2E test
+ setup_test_env
+ test_info 'Setting up test environment'
+ test_log INFO 'Setting up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] Setting up test environment'
[2026-01-28T12:23:51-05:00] [INFO] Setting up test environment
++ mktemp -d -t vc_e2e_test_fallback_probe_XXXXXX
+ TEST_TEMP_DIR=/data/tmp/vc_e2e_test_fallback_probe_T7T5xl
+ export TEST_TEMP_DIR
+ TEST_DB_PATH=/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/test.duckdb
+ export TEST_DB_PATH
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml
+ cat
+ export TEST_CONFIG_PATH
+ test_info 'Test temp dir: /data/tmp/vc_e2e_test_fallback_probe_T7T5xl'
+ test_log INFO 'Test temp dir: /data/tmp/vc_e2e_test_fallback_probe_T7T5xl'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_fallback_probe_T7T5xl'
[2026-01-28T12:23:51-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_fallback_probe_T7T5xl
+ test_info 'Test 1: Checking vc command availability'
+ test_log INFO 'Test 1: Checking vc command availability'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] Test 1: Checking vc command availability'
[2026-01-28T12:23:51-05:00] [INFO] Test 1: Checking vc command availability
+ [[ /data/tmp/cargo-target/debug/vc != \c\a\r\g\o\ \r\u\n* ]]
+ assert_file_exists /data/tmp/cargo-target/debug/vc 'vc binary should exist'
+ local path=/data/tmp/cargo-target/debug/vc
+ local 'msg=vc binary should exist'
+ TEST_ASSERTIONS=1
+ [[ -f /data/tmp/cargo-target/debug/vc ]]
+ test_info 'PASS: vc binary should exist (/data/tmp/cargo-target/debug/vc)'
+ test_log INFO 'PASS: vc binary should exist (/data/tmp/cargo-target/debug/vc)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] PASS: vc binary should exist (/data/tmp/cargo-target/debug/vc)'
[2026-01-28T12:23:51-05:00] [INFO] PASS: vc binary should exist (/data/tmp/cargo-target/debug/vc)
+ test_info 'Test 2: Checking vc --version'
+ test_log INFO 'Test 2: Checking vc --version'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:51-05:00] [INFO] Test 2: Checking vc --version'
[2026-01-28T12:23:51-05:00] [INFO] Test 2: Checking vc --version
++ run_vc --version
+ version_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ assert_contains '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)' vc 'Version should contain '\''vc'\'''
+ local 'haystack=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ local needle=vc
+ local 'msg=Version should contain '\''vc'\'''
+ TEST_ASSERTIONS=2
+ [[ ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) == *\v\c* ]]
+ test_info 'PASS: Version should contain '\''vc'\'''
+ test_log INFO 'PASS: Version should contain '\''vc'\'''
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [INFO] PASS: Version should contain '\''vc'\'''
[2026-01-28T12:23:52-05:00] [INFO] PASS: Version should contain 'vc'
+ assert_contains '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)' 0.1.0 'Version should contain version number'
+ local 'haystack=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z)'
+ local needle=0.1.0
+ local 'msg=Version should contain version number'
+ TEST_ASSERTIONS=3
+ [[ ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml --version
vc 0.1.0 (f1ec4596cd4637a74d960e174e7467d3ec3e8e50; built 2026-01-28T08:08:17.682376697Z) == *\0\.\1\.\0* ]]
+ test_info 'PASS: Version should contain version number'
+ test_log INFO 'PASS: Version should contain version number'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [INFO] PASS: Version should contain version number'
[2026-01-28T12:23:52-05:00] [INFO] PASS: Version should contain version number
+ test_info 'Test 3: Checking vc robot health'
+ test_log INFO 'Test 3: Checking vc robot health'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [INFO] Test 3: Checking vc robot health'
[2026-01-28T12:23:52-05:00] [INFO] Test 3: Checking vc robot health
++ run_vc robot health
+ health_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ assert_json_valid '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}' 'Health output should be valid JSON'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local 'msg=Health output should be valid JSON'
+ TEST_ASSERTIONS=4
+ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ jq .
+ test_error 'FAIL: Health output should be valid JSON'
+ test_log ERROR 'FAIL: Health output should be valid JSON'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Health output should be valid JSON'
[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Health output should be valid JSON
+ test_error '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ test_log ERROR '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
[2026-01-28T12:23:52-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}
+ TEST_FAILURES=1
+ assert_json_field '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}' .schema_version vc.robot.health.v1 'Schema version should match'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local field=.schema_version
+ local expected=vc.robot.health.v1
+ local 'msg=Schema version should match'
+ TEST_ASSERTIONS=5
++ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
++ jq -r .schema_version
+ local actual=
+ [[ '' == \v\c\.\r\o\b\o\t\.\h\e\a\l\t\h\.\v\1 ]]
+ test_error 'FAIL: Schema version should match'
+ test_log ERROR 'FAIL: Schema version should match'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Schema version should match'
[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Schema version should match
+ test_error '  Field: .schema_version'
+ test_log ERROR '  Field: .schema_version'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Field: .schema_version'
[2026-01-28T12:23:52-05:00] [ERROR]   Field: .schema_version
+ test_error '  Expected: vc.robot.health.v1'
+ test_log ERROR '  Expected: vc.robot.health.v1'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Expected: vc.robot.health.v1'
[2026-01-28T12:23:52-05:00] [ERROR]   Expected: vc.robot.health.v1
+ test_error '  Actual: '
+ test_log ERROR '  Actual: '
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Actual: '
[2026-01-28T12:23:52-05:00] [ERROR]   Actual: 
+ TEST_FAILURES=2
+ assert_json_field '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}' .data.overall.severity healthy 'Severity should be healthy'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local field=.data.overall.severity
+ local expected=healthy
+ local 'msg=Severity should be healthy'
+ TEST_ASSERTIONS=6
++ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ jq -r .data.overall.severity
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:23:52.326706395Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:23:52.326653285Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local actual=
+ [[ '' == \h\e\a\l\t\h\y ]]
+ test_error 'FAIL: Severity should be healthy'
+ test_log ERROR 'FAIL: Severity should be healthy'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Severity should be healthy'
[2026-01-28T12:23:52-05:00] [ERROR] FAIL: Severity should be healthy
+ test_error '  Field: .data.overall.severity'
+ test_log ERROR '  Field: .data.overall.severity'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Field: .data.overall.severity'
[2026-01-28T12:23:52-05:00] [ERROR]   Field: .data.overall.severity
+ test_error '  Expected: healthy'
+ test_log ERROR '  Expected: healthy'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Expected: healthy'
[2026-01-28T12:23:52-05:00] [ERROR]   Expected: healthy
+ test_error '  Actual: '
+ test_log ERROR '  Actual: '
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [ERROR]   Actual: '
[2026-01-28T12:23:52-05:00] [ERROR]   Actual: 
+ TEST_FAILURES=3
+ test_info 'Test 4: Checking vc robot triage'
+ test_log INFO 'Test 4: Checking vc robot triage'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:52-05:00] [INFO] Test 4: Checking vc robot triage'
[2026-01-28T12:23:52-05:00] [INFO] Test 4: Checking vc robot triage
++ run_vc robot triage
+ triage_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ assert_json_valid '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}' 'Triage output should be valid JSON'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ local 'msg=Triage output should be valid JSON'
+ TEST_ASSERTIONS=7
+ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ jq .
+ test_error 'FAIL: Triage output should be valid JSON'
+ test_log ERROR 'FAIL: Triage output should be valid JSON'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR] FAIL: Triage output should be valid JSON'
[2026-01-28T12:23:53-05:00] [ERROR] FAIL: Triage output should be valid JSON
+ test_error '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ test_log ERROR '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
[2026-01-28T12:23:53-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}
+ TEST_FAILURES=4
+ assert_json_field '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}' .schema_version vc.robot.triage.v1 'Schema version should match'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
+ local field=.schema_version
+ local expected=vc.robot.triage.v1
+ local 'msg=Schema version should match'
+ TEST_ASSERTIONS=8
++ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml robot triage
{
  "schema_version": "vc.robot.triage.v1",
  "generated_at": "2026-01-28T17:23:53.095732741Z",
  "data": {
    "recommendations": [],
    "suggested_commands": [
      {
        "command": "vc collect",
        "reason": "Run initial data collection",
        "confidence": 0.9
      }
    ]
  }
}'
++ jq -r .schema_version
+ local actual=
+ [[ '' == \v\c\.\r\o\b\o\t\.\t\r\i\a\g\e\.\v\1 ]]
+ test_error 'FAIL: Schema version should match'
+ test_log ERROR 'FAIL: Schema version should match'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR] FAIL: Schema version should match'
[2026-01-28T12:23:53-05:00] [ERROR] FAIL: Schema version should match
+ test_error '  Field: .schema_version'
+ test_log ERROR '  Field: .schema_version'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR]   Field: .schema_version'
[2026-01-28T12:23:53-05:00] [ERROR]   Field: .schema_version
+ test_error '  Expected: vc.robot.triage.v1'
+ test_log ERROR '  Expected: vc.robot.triage.v1'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR]   Expected: vc.robot.triage.v1'
[2026-01-28T12:23:53-05:00] [ERROR]   Expected: vc.robot.triage.v1
+ test_error '  Actual: '
+ test_log ERROR '  Actual: '
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [ERROR]   Actual: '
[2026-01-28T12:23:53-05:00] [ERROR]   Actual: 
+ TEST_FAILURES=5
+ test_info 'Test 5: Checking config parsing'
+ test_log INFO 'Test 5: Checking config parsing'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [INFO] Test 5: Checking config parsing'
[2026-01-28T12:23:53-05:00] [INFO] Test 5: Checking config parsing
+ assert_file_exists /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml 'Test config should exist'
+ local path=/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml
+ local 'msg=Test config should exist'
+ TEST_ASSERTIONS=9
+ [[ -f /data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml ]]
+ test_info 'PASS: Test config should exist (/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml)'
+ test_log INFO 'PASS: Test config should exist (/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [INFO] PASS: Test config should exist (/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml)'
[2026-01-28T12:23:53-05:00] [INFO] PASS: Test config should exist (/data/tmp/vc_e2e_test_fallback_probe_T7T5xl/config.toml)
+ finalize_test
++ date +%s%N
+ local end_time=1769621033450179592
+ local duration_ms=1984
+ local status=passed
+ local exit_code=0
+ [[ 5 -gt 0 ]]
+ status=failed
+ exit_code=1
+ cat
+ test_info 'Test complete: 9 assertions, 5 failures'
+ test_log INFO 'Test complete: 9 assertions, 5 failures'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [INFO] Test complete: 9 assertions, 5 failures'
[2026-01-28T12:23:53-05:00] [INFO] Test complete: 9 assertions, 5 failures
+ exit 1
+ cleanup_test_env
+ local exit_code=1
+ test_info 'Cleaning up test environment'
+ test_log INFO 'Cleaning up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:23:53-05:00] [INFO] Cleaning up test environment'
[2026-01-28T12:23:53-05:00] [INFO] Cleaning up test environment
+ [[ -n /data/tmp/vc_e2e_test_fallback_probe_T7T5xl ]]
+ [[ -d /data/tmp/vc_e2e_test_fallback_probe_T7T5xl ]]
+ [[ 1 -ne 0 ]]
+ [[ '' == \t\r\u\e ]]
+ rm -rf /data/tmp/vc_e2e_test_fallback_probe_T7T5xl
