+ set -euo pipefail
++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/test_sysmoni_collect.sh
+ source /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
++ set -euo pipefail
++++ dirname /data/projects/vibe_cockpit/tests/e2e/collectors/../lib/test_helpers.sh
+++ cd /data/projects/vibe_cockpit/tests/e2e/collectors/../lib
+++ pwd
++ TEST_LIB_DIR=/data/projects/vibe_cockpit/tests/e2e/lib
+++ dirname /data/projects/vibe_cockpit/tests/e2e/lib
++ E2E_DIR=/data/projects/vibe_cockpit/tests/e2e
+++ cd /data/projects/vibe_cockpit/tests/e2e/../..
+++ pwd
++ PROJECT_ROOT=/data/projects/vibe_cockpit
+++ find_vc_binary
+++ [[ -n /data/tmp/cargo-target ]]
+++ [[ -x /data/tmp/cargo-target/debug/vc ]]
+++ echo /data/tmp/cargo-target/debug/vc
+++ return
++ VC_BIN=/data/tmp/cargo-target/debug/vc
+++ basename /data/projects/vibe_cockpit/tests/e2e/collectors/test_sysmoni_collect.sh .sh
++ TEST_NAME=test_sysmoni_collect
++ TEST_ASSERTIONS=0
++ TEST_FAILURES=0
+++ date +%s%N
++ TEST_START_TIME=1769621045394225786
++ RED='\033[0;31m'
++ GREEN='\033[0;32m'
++ YELLOW='\033[1;33m'
++ NC='\033[0m'
++ trap cleanup_test_env EXIT
+ test_info 'Starting sysmoni collector E2E test'
+ test_log INFO 'Starting sysmoni collector E2E test'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] Starting sysmoni collector E2E test'
[2026-01-28T12:24:05-05:00] [INFO] Starting sysmoni collector E2E test
+ setup_test_env
+ test_info 'Setting up test environment'
+ test_log INFO 'Setting up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] Setting up test environment'
[2026-01-28T12:24:05-05:00] [INFO] Setting up test environment
++ mktemp -d -t vc_e2e_test_sysmoni_collect_XXXXXX
+ TEST_TEMP_DIR=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp
+ export TEST_TEMP_DIR
+ TEST_DB_PATH=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/test.duckdb
+ export TEST_DB_PATH
+ TEST_CONFIG_PATH=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml
+ cat
+ export TEST_CONFIG_PATH
+ test_info 'Test temp dir: /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp'
+ test_log INFO 'Test temp dir: /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp'
[2026-01-28T12:24:05-05:00] [INFO] Test temp dir: /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp
+ SYSMONI_FIXTURE=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json
+ cat
+ test_info 'Test 1: Validating sysmoni fixture JSON'
+ test_log INFO 'Test 1: Validating sysmoni fixture JSON'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] Test 1: Validating sysmoni fixture JSON'
[2026-01-28T12:24:05-05:00] [INFO] Test 1: Validating sysmoni fixture JSON
+ assert_file_exists /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json 'Sysmoni fixture should exist'
+ local path=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json
+ local 'msg=Sysmoni fixture should exist'
+ TEST_ASSERTIONS=1
+ [[ -f /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json ]]
+ test_info 'PASS: Sysmoni fixture should exist (/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json)'
+ test_log INFO 'PASS: Sysmoni fixture should exist (/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] PASS: Sysmoni fixture should exist (/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json)'
[2026-01-28T12:24:05-05:00] [INFO] PASS: Sysmoni fixture should exist (/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json)
++ cat /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_output.json
+ sysmoni_content='{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ assert_json_valid '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}' 'Sysmoni fixture should be valid JSON'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ local 'msg=Sysmoni fixture should be valid JSON'
+ TEST_ASSERTIONS=2
+ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ jq .
+ test_info 'PASS: Sysmoni fixture should be valid JSON'
+ test_log INFO 'PASS: Sysmoni fixture should be valid JSON'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] PASS: Sysmoni fixture should be valid JSON'
[2026-01-28T12:24:05-05:00] [INFO] PASS: Sysmoni fixture should be valid JSON
+ test_info 'Test 2: Checking CPU metrics structure'
+ test_log INFO 'Test 2: Checking CPU metrics structure'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] Test 2: Checking CPU metrics structure'
[2026-01-28T12:24:05-05:00] [INFO] Test 2: Checking CPU metrics structure
+ assert_json_field '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}' .cpu.total_percent 45.2 'CPU total percent'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ local field=.cpu.total_percent
+ local expected=45.2
+ local 'msg=CPU total percent'
+ TEST_ASSERTIONS=3
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq -r .cpu.total_percent
+ local actual=45.2
+ [[ 45.2 == \4\5\.\2 ]]
+ test_info 'PASS: CPU total percent (.cpu.total_percent = 45.2)'
+ test_log INFO 'PASS: CPU total percent (.cpu.total_percent = 45.2)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:05-05:00] [INFO] PASS: CPU total percent (.cpu.total_percent = 45.2)'
[2026-01-28T12:24:05-05:00] [INFO] PASS: CPU total percent (.cpu.total_percent = 45.2)
+ assert_json_field '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}' .cpu.load_1 2.1 'Load 1 minute average'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ local field=.cpu.load_1
+ local expected=2.1
+ local 'msg=Load 1 minute average'
+ TEST_ASSERTIONS=4
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq -r .cpu.load_1
+ local actual=2.1
+ [[ 2.1 == \2\.\1 ]]
+ test_info 'PASS: Load 1 minute average (.cpu.load_1 = 2.1)'
+ test_log INFO 'PASS: Load 1 minute average (.cpu.load_1 = 2.1)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 1 minute average (.cpu.load_1 = 2.1)'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 1 minute average (.cpu.load_1 = 2.1)
+ assert_json_field '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}' .cpu.load_5 1.8 'Load 5 minute average'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ local field=.cpu.load_5
+ local expected=1.8
+ local 'msg=Load 5 minute average'
+ TEST_ASSERTIONS=5
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq -r .cpu.load_5
+ local actual=1.8
+ [[ 1.8 == \1\.\8 ]]
+ test_info 'PASS: Load 5 minute average (.cpu.load_5 = 1.8)'
+ test_log INFO 'PASS: Load 5 minute average (.cpu.load_5 = 1.8)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 5 minute average (.cpu.load_5 = 1.8)'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 5 minute average (.cpu.load_5 = 1.8)
+ assert_json_field '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}' .cpu.load_15 1.5 'Load 15 minute average'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
+ local field=.cpu.load_15
+ local expected=1.5
+ local 'msg=Load 15 minute average'
+ TEST_ASSERTIONS=6
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq -r .cpu.load_15
+ local actual=1.5
+ [[ 1.5 == \1\.\5 ]]
+ test_info 'PASS: Load 15 minute average (.cpu.load_15 = 1.5)'
+ test_log INFO 'PASS: Load 15 minute average (.cpu.load_15 = 1.5)'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 15 minute average (.cpu.load_15 = 1.5)'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Load 15 minute average (.cpu.load_15 = 1.5)
+ test_info 'Test 3: Checking memory metrics structure'
+ test_log INFO 'Test 3: Checking memory metrics structure'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] Test 3: Checking memory metrics structure'
[2026-01-28T12:24:06-05:00] [INFO] Test 3: Checking memory metrics structure
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq .memory.total_bytes
+ memory_total=34359738368
+ assert_ne null 34359738368 'Memory total should exist'
+ local unexpected=null
+ local actual=34359738368
+ local 'msg=Memory total should exist'
+ TEST_ASSERTIONS=7
+ [[ null != \3\4\3\5\9\7\3\8\3\6\8 ]]
+ test_info 'PASS: Memory total should exist'
+ test_log INFO 'PASS: Memory total should exist'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Memory total should exist'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Memory total should exist
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq .memory.available_bytes
+ memory_available=10737418240
+ assert_ne null 10737418240 'Memory available should exist'
+ local unexpected=null
+ local actual=10737418240
+ local 'msg=Memory available should exist'
+ TEST_ASSERTIONS=8
+ [[ null != \1\0\7\3\7\4\1\8\2\4\0 ]]
+ test_info 'PASS: Memory available should exist'
+ test_log INFO 'PASS: Memory available should exist'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Memory available should exist'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Memory available should exist
+ test_info 'Test 4: Checking process list structure'
+ test_log INFO 'Test 4: Checking process list structure'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] Test 4: Checking process list structure'
[2026-01-28T12:24:06-05:00] [INFO] Test 4: Checking process list structure
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq '.processes | length'
+ process_count=2
+ assert_eq 2 2 'Should have 2 processes in fixture'
+ local expected=2
+ local actual=2
+ local 'msg=Should have 2 processes in fixture'
+ TEST_ASSERTIONS=9
+ [[ 2 == \2 ]]
+ test_info 'PASS: Should have 2 processes in fixture'
+ test_log INFO 'PASS: Should have 2 processes in fixture'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Should have 2 processes in fixture'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Should have 2 processes in fixture
+ test_info 'Test 5: Checking network metrics structure'
+ test_log INFO 'Test 5: Checking network metrics structure'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] Test 5: Checking network metrics structure'
[2026-01-28T12:24:06-05:00] [INFO] Test 5: Checking network metrics structure
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq .network.rx_bytes_per_sec
+ rx_bytes=10485760
+ assert_ne null 10485760 'Network RX should exist'
+ local unexpected=null
+ local actual=10485760
+ local 'msg=Network RX should exist'
+ TEST_ASSERTIONS=10
+ [[ null != \1\0\4\8\5\7\6\0 ]]
+ test_info 'PASS: Network RX should exist'
+ test_log INFO 'PASS: Network RX should exist'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Network RX should exist'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Network RX should exist
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq .network.tx_bytes_per_sec
+ tx_bytes=5242880
+ assert_ne null 5242880 'Network TX should exist'
+ local unexpected=null
+ local actual=5242880
+ local 'msg=Network TX should exist'
+ TEST_ASSERTIONS=11
+ [[ null != \5\2\4\2\8\8\0 ]]
+ test_info 'PASS: Network TX should exist'
+ test_log INFO 'PASS: Network TX should exist'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Network TX should exist'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Network TX should exist
+ test_info 'Test 6: Checking disk metrics structure'
+ test_log INFO 'Test 6: Checking disk metrics structure'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] Test 6: Checking disk metrics structure'
[2026-01-28T12:24:06-05:00] [INFO] Test 6: Checking disk metrics structure
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 45.2,
        "per_core": [42.1, 48.3, 44.0, 46.4],
        "load_1": 2.1,
        "load_5": 1.8,
        "load_15": 1.5
    },
    "memory": {
        "total_bytes": 34359738368,
        "used_bytes": 23622320128,
        "available_bytes": 10737418240,
        "swap_total_bytes": 8589934592,
        "swap_used_bytes": 1073741824
    },
    "disk": {
        "read_bytes_per_sec": 1048576,
        "write_bytes_per_sec": 2097152,
        "filesystems": [
            {"mount": "/", "total_bytes": 500107862016, "used_bytes": 350075103232},
            {"mount": "/home", "total_bytes": 1000204886016, "used_bytes": 600122931200}
        ]
    },
    "network": {
        "rx_bytes_per_sec": 10485760,
        "tx_bytes_per_sec": 5242880
    },
    "processes": [
        {"pid": 1234, "name": "cargo", "cpu_percent": 45.0, "memory_bytes": 1073741824},
        {"pid": 5678, "name": "rust-analyzer", "cpu_percent": 12.5, "memory_bytes": 536870912}
    ]
}'
++ jq '.disk.filesystems | length'
+ fs_count=2
+ assert_eq 2 2 'Should have 2 filesystems in fixture'
+ local expected=2
+ local actual=2
+ local 'msg=Should have 2 filesystems in fixture'
+ TEST_ASSERTIONS=12
+ [[ 2 == \2 ]]
+ test_info 'PASS: Should have 2 filesystems in fixture'
+ test_log INFO 'PASS: Should have 2 filesystems in fixture'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:06-05:00] [INFO] PASS: Should have 2 filesystems in fixture'
[2026-01-28T12:24:06-05:00] [INFO] PASS: Should have 2 filesystems in fixture
+ test_info 'Test 7: Checking vc robot health with stub implementation'
+ test_log INFO 'Test 7: Checking vc robot health with stub implementation'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [INFO] Test 7: Checking vc robot health with stub implementation'
[2026-01-28T12:24:07-05:00] [INFO] Test 7: Checking vc robot health with stub implementation
++ run_vc robot health
+ health_output='++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ assert_json_valid '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}' 'Health output should be valid JSON'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local 'msg=Health output should be valid JSON'
+ TEST_ASSERTIONS=13
+ jq .
+ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ test_error 'FAIL: Health output should be valid JSON'
+ test_log ERROR 'FAIL: Health output should be valid JSON'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Health output should be valid JSON'
[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Health output should be valid JSON
+ test_error '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ test_log ERROR '  Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
[2026-01-28T12:24:07-05:00] [ERROR]   Invalid JSON: ++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}
+ TEST_FAILURES=1
+ assert_json_field '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}' .schema_version vc.robot.health.v1 'Health schema version'
+ local 'json=++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
+ local field=.schema_version
+ local expected=vc.robot.health.v1
+ local 'msg=Health schema version'
+ TEST_ASSERTIONS=14
++ echo '++ [[ /data/tmp/cargo-target/debug/vc == \c\a\r\g\o\ \r\u\n* ]]
++ [[ -x /data/tmp/cargo-target/debug/vc ]]
++ /data/tmp/cargo-target/debug/vc --config /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/config.toml robot health
{
  "schema_version": "vc.robot.health.v1",
  "generated_at": "2026-01-28T17:24:07.115276312Z",
  "data": {
    "overall": {
      "score": 1.0,
      "severity": "healthy",
      "active_alerts": 0,
      "machine_count": 1,
      "agent_count": 0
    },
    "machines": [
      {
        "id": "local",
        "name": "Local Machine",
        "score": 1.0,
        "status": "online",
        "top_issue": null,
        "last_seen": "2026-01-28T17:24:07.115174700Z",
        "agent_count": 0,
        "cpu_percent": null,
        "memory_percent": null
      }
    ],
    "alerts_by_severity": {
      "critical": 0,
      "warning": 0,
      "info": 0
    }
  },
  "warnings": [
    "No collectors have run yet - data may be incomplete"
  ]
}'
++ jq -r .schema_version
+ local actual=
+ [[ '' == \v\c\.\r\o\b\o\t\.\h\e\a\l\t\h\.\v\1 ]]
+ test_error 'FAIL: Health schema version'
+ test_log ERROR 'FAIL: Health schema version'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Health schema version'
[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Health schema version
+ test_error '  Field: .schema_version'
+ test_log ERROR '  Field: .schema_version'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Field: .schema_version'
[2026-01-28T12:24:07-05:00] [ERROR]   Field: .schema_version
+ test_error '  Expected: vc.robot.health.v1'
+ test_log ERROR '  Expected: vc.robot.health.v1'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Expected: vc.robot.health.v1'
[2026-01-28T12:24:07-05:00] [ERROR]   Expected: vc.robot.health.v1
+ test_error '  Actual: '
+ test_log ERROR '  Actual: '
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Actual: '
[2026-01-28T12:24:07-05:00] [ERROR]   Actual: 
+ TEST_FAILURES=2
+ test_info 'Test 8: Testing minimal sysmoni output parsing'
+ test_log INFO 'Test 8: Testing minimal sysmoni output parsing'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [INFO] Test 8: Testing minimal sysmoni output parsing'
[2026-01-28T12:24:07-05:00] [INFO] Test 8: Testing minimal sysmoni output parsing
+ MINIMAL_FIXTURE=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_minimal.json
+ cat
++ cat /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_minimal.json
+ minimal_content='{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}'
+ assert_json_valid '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}' 'Minimal fixture should be valid JSON'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}'
+ local 'msg=Minimal fixture should be valid JSON'
+ TEST_ASSERTIONS=15
+ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}'
+ jq .
+ test_info 'PASS: Minimal fixture should be valid JSON'
+ test_log INFO 'PASS: Minimal fixture should be valid JSON'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [INFO] PASS: Minimal fixture should be valid JSON'
[2026-01-28T12:24:07-05:00] [INFO] PASS: Minimal fixture should be valid JSON
+ assert_json_field '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}' .cpu.total_percent 10 'Minimal CPU percent'
+ local 'json={
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}'
+ local field=.cpu.total_percent
+ local expected=10
+ local 'msg=Minimal CPU percent'
+ TEST_ASSERTIONS=16
++ echo '{
    "timestamp": "2026-01-28T00:00:00Z",
    "cpu": {
        "total_percent": 10.0
    },
    "memory": {
        "total_bytes": 8589934592
    }
}'
++ jq -r .cpu.total_percent
+ local actual=10.0
+ [[ 10.0 == \1\0 ]]
+ test_error 'FAIL: Minimal CPU percent'
+ test_log ERROR 'FAIL: Minimal CPU percent'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Minimal CPU percent'
[2026-01-28T12:24:07-05:00] [ERROR] FAIL: Minimal CPU percent
+ test_error '  Field: .cpu.total_percent'
+ test_log ERROR '  Field: .cpu.total_percent'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Field: .cpu.total_percent'
[2026-01-28T12:24:07-05:00] [ERROR]   Field: .cpu.total_percent
+ test_error '  Expected: 10'
+ test_log ERROR '  Expected: 10'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Expected: 10'
[2026-01-28T12:24:07-05:00] [ERROR]   Expected: 10
+ test_error '  Actual: 10.0'
+ test_log ERROR '  Actual: 10.0'
+ local level=ERROR
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [ERROR]   Actual: 10.0'
[2026-01-28T12:24:07-05:00] [ERROR]   Actual: 10.0
+ TEST_FAILURES=3
+ test_info 'Test 9: Testing invalid JSON handling'
+ test_log INFO 'Test 9: Testing invalid JSON handling'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:07-05:00] [INFO] Test 9: Testing invalid JSON handling'
[2026-01-28T12:24:07-05:00] [INFO] Test 9: Testing invalid JSON handling
+ INVALID_FIXTURE=/data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_invalid.json
+ echo 'not valid json {'
+ jq . /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp/sysmoni_invalid.json
+ test_info 'PASS: Invalid JSON correctly rejected'
+ test_log INFO 'PASS: Invalid JSON correctly rejected'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:08-05:00] [INFO] PASS: Invalid JSON correctly rejected'
[2026-01-28T12:24:08-05:00] [INFO] PASS: Invalid JSON correctly rejected
+ TEST_ASSERTIONS=17
+ finalize_test
++ date +%s%N
+ local end_time=1769621048108340806
+ local duration_ms=2714
+ local status=passed
+ local exit_code=0
+ [[ 3 -gt 0 ]]
+ status=failed
+ exit_code=1
+ cat
+ test_info 'Test complete: 17 assertions, 3 failures'
+ test_log INFO 'Test complete: 17 assertions, 3 failures'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:08-05:00] [INFO] Test complete: 17 assertions, 3 failures'
[2026-01-28T12:24:08-05:00] [INFO] Test complete: 17 assertions, 3 failures
+ exit 1
+ cleanup_test_env
+ local exit_code=1
+ test_info 'Cleaning up test environment'
+ test_log INFO 'Cleaning up test environment'
+ local level=INFO
+ shift
++ date -Iseconds
+ echo '[2026-01-28T12:24:08-05:00] [INFO] Cleaning up test environment'
[2026-01-28T12:24:08-05:00] [INFO] Cleaning up test environment
+ [[ -n /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp ]]
+ [[ -d /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp ]]
+ [[ 1 -ne 0 ]]
+ [[ '' == \t\r\u\e ]]
+ rm -rf /data/tmp/vc_e2e_test_sysmoni_collect_krwZGp
